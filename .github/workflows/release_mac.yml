name: Build and Release macOS

on:
  push:
    branches:
      - '*'  

jobs:
  build_macos:
    runs-on: macos-latest
    steps:
      - name: Install Rosetta 2
        run: softwareupdate --install-rosetta --agree-to-license
        shell: /usr/bin/arch -x86_64 /bin/bash
        
      - name: Install Node.js x64
        run: |
          arch -x86_64 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh)"
          export NVM_DIR="$HOME/.nvm"
          source "$NVM_DIR/nvm.sh"
          nvm install --arch=x64 16 # ou a vers√£o desejada
          nvm use --arch=x64 16

      - name: Install Dependencies
        run: nvm exec --arch=x64 npm install
        
      - name: Build Project
        run: nvm exec --arch=x64 npm run build
        
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.14.2'

      - name: Install dependencies
        run: npm ci

      - name: Build macOS app
        run: npm run build:mac

      - name: Upload .dmg to GitHub Actions artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build
          path: dist/*.dmg